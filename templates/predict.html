<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Assessment - Heart Triage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .form-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        .result-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            animation: fadeIn 0.5s;
        }
        .risk-badge {
            font-size: 1.2rem;
            padding: 10px 20px;
            border-radius: 50px;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .feature-input {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin-bottom: 20px;
        }
        .feature-input label {
            font-weight: 600;
            color: #333;
        }
        .feature-input small {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-heartbeat me-2"></i>Heart Triage AI
            </a>
            <a href="/" class="btn btn-outline-light">
                <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <!-- Left Column: Form -->
            <div class="col-lg-6">
                <div class="form-card">
                    <h2 class="mb-4">
                        <i class="fas fa-stethoscope me-2"></i>Patient Assessment
                    </h2>
                    
                    {% if error %}
                    <div class="alert alert-danger">{{ error }}</div>
                    {% endif %}
                    
                    <form method="POST" action="/predict">
                        <!-- Demographic Information -->
                        <h5 class="mt-4 mb-3 text-primary">
                            <i class="fas fa-user me-2"></i>Demographic Information
                        </h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="feature-input">
                                    <label class="form-label">Age (years)</label>
                                    <input type="number" class="form-control" name="age" 
                                           min="20" max="100" value="50" required>
                                    <small>Patient's age in years</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="feature-input">
                                    <label class="form-label">Sex</label>
                                    <select class="form-select" name="sex" required>
                                        <option value="1">Male</option>
                                        <option value="0">Female</option>
                                    </select>
                                    <small>Biological sex</small>
                                </div>
                            </div>
                        </div>

                        <!-- Clinical Measurements -->
                        <h5 class="mt-4 mb-3 text-primary">
                            <i class="fas fa-heartbeat me-2"></i>Clinical Measurements
                        </h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="feature-input">
                                    <label class="form-label">Resting BP (mm Hg)</label>
                                    <input type="number" class="form-control" name="trestbps" 
                                           min="90" max="200" value="120" required>
                                    <small>Resting blood pressure</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="feature-input">
                                    <label class="form-label">Cholesterol (mg/dL)</label>
                                    <input type="number" class="form-control" name="chol" 
                                           min="100" max="600" value="200" required>
                                    <small>Serum cholesterol level</small>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Features -->
                        <h5 class="mt-4 mb-3 text-primary">
                            <i class="fas fa-clipboard-list me-2"></i>Additional Parameters
                        </h5>
                        
                        <!-- Chest Pain Type -->
                        <div class="feature-input">
                            <label class="form-label">Chest Pain Type</label>
                            <select class="form-select" name="cp" required>
                                <option value="0">Typical angina</option>
                                <option value="1">Atypical angina</option>
                                <option value="2">Non-anginal pain</option>
                                <option value="3">Asymptomatic</option>
                            </select>
                            <small>Type of chest pain experienced</small>
                        </div>

                        <!-- Fasting Blood Sugar -->
                        <div class="feature-input">
                            <label class="form-label">Fasting Blood Sugar > 120 mg/dL</label>
                            <select class="form-select" name="fbs" required>
                                <option value="0">False</option>
                                <option value="1">True</option>
                            </select>
                            <small>Fasting blood sugar level</small>
                        </div>

                        <!-- Resting ECG -->
                        <div class="feature-input">
                            <label class="form-label">Resting ECG Results</label>
                            <select class="form-select" name="restecg" required>
                                <option value="0">Normal</option>
                                <option value="1">ST-T wave abnormality</option>
                                <option value="2">Left ventricular hypertrophy</option>
                            </select>
                            <small>Resting electrocardiographic results</small>
                        </div>

                        <!-- Max Heart Rate -->
                        <div class="feature-input">
                            <label class="form-label">Max Heart Rate</label>
                            <input type="number" class="form-control" name="thalach" 
                                   min="60" max="220" value="150" required>
                            <small>Maximum heart rate achieved</small>
                        </div>

                        <!-- Exercise Angina -->
                        <div class="feature-input">
                            <label class="form-label">Exercise Induced Angina</label>
                            <select class="form-select" name="exang" required>
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                            <small>Angina induced by exercise</small>
                        </div>

                        <!-- ST Depression -->
                        <div class="feature-input">
                            <label class="form-label">ST Depression (oldpeak)</label>
                            <input type="number" step="0.1" class="form-control" name="oldpeak" 
                                   min="0" max="6" value="1.0" required>
                            <small>ST depression induced by exercise</small>
                        </div>

                        <!-- Slope -->
                        <div class="feature-input">
                            <label class="form-label">Slope of Peak Exercise ST Segment</label>
                            <select class="form-select" name="slope" required>
                                <option value="0">Upsloping</option>
                                <option value="1">Flat</option>
                                <option value="2">Downsloping</option>
                            </select>
                            <small>Slope of peak exercise ST segment</small>
                        </div>

                        <!-- Number of Major Vessels -->
                        <div class="feature-input">
                            <label class="form-label">Number of Major Vessels (0-3)</label>
                            <input type="number" class="form-control" name="ca" 
                                   min="0" max="3" value="0" required>
                            <small>Number of major vessels colored by fluoroscopy</small>
                        </div>

                        <!-- Thalassemia -->
                        <div class="feature-input">
                            <label class="form-label">Thalassemia</label>
                            <select class="form-select" name="thal" required>
                                <option value="1">Normal</option>
                                <option value="2">Fixed defect</option>
                                <option value="3">Reversible defect</option>
                            </select>
                            <small>Thalassemia diagnosis</small>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-calculator me-2"></i>Calculate Risk
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="fillSampleData()">
                                <i class="fas fa-vial me-2"></i>Fill Sample Data
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="col-lg-6">
                {% if show_result and prediction %}
                <div class="result-card">
                    <h2 class="mb-4">
                        <i class="fas fa-chart-bar me-2"></i>Assessment Results
                    </h2>
                    
                    <!-- Risk Level Display -->
                    <div class="text-center mb-4">
                        <span class="risk-badge" style="background-color: {{ prediction.color }}; color: white;">
                            {{ prediction.risk_label }}
                        </span>
                        <h3 class="mt-3">{{ prediction.description }}</h3>
                    </div>

                    <!-- Probability Distribution -->
                    <h5 class="mt-4 mb-3">Risk Probability Distribution</h5>
                    {{ visualization|safe }}

                    <!-- Risk Factors -->
                    {% if explanation.risk_factors %}
                    <div class="mt-4">
                        <h5><i class="fas fa-exclamation-triangle me-2 text-warning"></i>Identified Risk Factors</h5>
                        <ul class="list-group">
                            {% for factor in explanation.risk_factors %}
                            <li class="list-group-item">{{ factor }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <!-- Recommendations -->
                    <div class="mt-4">
                        <h5><i class="fas fa-clipboard-check me-2 text-success"></i>Recommendations</h5>
                        <div class="alert alert-{{ 'success' if prediction.risk_level == 0 else 'warning' if prediction.risk_level == 1 else 'danger' }}">
                            <ul class="mb-0">
                                {% for recommendation in explanation.recommendations %}
                                <li>{{ recommendation }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-grid gap-2 mt-4">
                        <a href="/predict" class="btn btn-outline-primary">
                            <i class="fas fa-redo me-2"></i>New Assessment
                        </a>
                        <button class="btn btn-outline-success" onclick="window.print()">
                            <i class="fas fa-print me-2"></i>Print Report
                        </button>
                    </div>
                </div>
                {% else %}
                <div class="result-card text-center" style="opacity: 0.7;">
                    <i class="fas fa-chart-bar fa-4x mb-3 text-muted"></i>
                    <h3 class="text-muted">Assessment Results</h3>
                    <p class="text-muted">
                        Submit the form to see risk assessment results, 
                        probability distribution, and recommendations.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Function to fill sample data for testing
        function fillSampleData() {
            const sampleData = {
                'age': 58,
                'sex': 1,
                'cp': 0,
                'trestbps': 140,
                'chol': 280,
                'fbs': 0,
                'restecg': 1,
                'thalach': 160,
                'exang': 0,
                'oldpeak': 2.5,
                'slope': 2,
                'ca': 1,
                'thal': 2
            };
            
            Object.keys(sampleData).forEach(key => {
                const element = document.querySelector(`[name="${key}"]`);
                if (element) {
                    element.value = sampleData[key];
                }
            });
            
            alert('Sample data loaded. Click "Calculate Risk" to see prediction.');
        }
    </script>
</body>
</html>